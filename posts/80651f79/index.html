<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=6.5.0">


  <link rel="mask-icon" href="/images/safari_pinned_tab.svg?v=6.5.0" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml">







<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="简介 汇编语言与机器语言之间是一一对应的,不同的CPU支持的机器指令也是不一样的,一种CPU能执行的全局机器指令集合就是该CPU的指令集.CPU顺序的执行机器指令,访问存储器获取数据,同时有若干寄存器存放临时数据. IA-32是Intel研发的一种CPU架构.包括Intel 80386/80486,Intel Pentium,Intel Xeon,Intel Core.使用小端法存储数据(高位">
<meta name="keywords" content="assembly">
<meta property="og:type" content="article">
<meta property="og:title" content="CS-BASIC-assembly-IA32-基础">
<meta property="og:url" content="https://hitworld.github.io/posts/80651f79/index.html">
<meta property="og:site_name" content="w4rd3n">
<meta property="og:description" content="简介 汇编语言与机器语言之间是一一对应的,不同的CPU支持的机器指令也是不一样的,一种CPU能执行的全局机器指令集合就是该CPU的指令集.CPU顺序的执行机器指令,访问存储器获取数据,同时有若干寄存器存放临时数据. IA-32是Intel研发的一种CPU架构.包括Intel 80386/80486,Intel Pentium,Intel Xeon,Intel Core.使用小端法存储数据(高位">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://hitworld.github.io/posts/80651f79/1.png">
<meta property="og:image" content="https://hitworld.github.io/posts/80651f79/5.png">
<meta property="og:image" content="https://hitworld.github.io/posts/80651f79/4.png">
<meta property="og:image" content="https://hitworld.github.io/posts/80651f79/2.png">
<meta property="og:image" content="https://hitworld.github.io/posts/80651f79/3.png">
<meta property="og:image" content="https://hitworld.github.io/posts/80651f79/6.png">
<meta property="og:updated_time" content="2020-10-22T11:34:05.906Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CS-BASIC-assembly-IA32-基础">
<meta name="twitter:description" content="简介 汇编语言与机器语言之间是一一对应的,不同的CPU支持的机器指令也是不一样的,一种CPU能执行的全局机器指令集合就是该CPU的指令集.CPU顺序的执行机器指令,访问存储器获取数据,同时有若干寄存器存放临时数据. IA-32是Intel研发的一种CPU架构.包括Intel 80386/80486,Intel Pentium,Intel Xeon,Intel Core.使用小端法存储数据(高位">
<meta name="twitter:image" content="https://hitworld.github.io/posts/80651f79/1.png">






  <link rel="canonical" href="https://hitworld.github.io/posts/80651f79/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>CS-BASIC-assembly-IA32-基础 | w4rd3n</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">w4rd3n</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">混吃等死</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>友链</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hitworld.github.io/posts/80651f79/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="w4rd3n">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/apple-touch-icon.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="w4rd3n">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CS-BASIC-assembly-IA32-基础
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-09-04 13:30:06" itemprop="dateCreated datePublished" datetime="2019-09-04T13:30:06+08:00">2019-09-04</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/CS/BASIC/" itemprop="url" rel="index"><span itemprop="name">BASIC</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/80651f79/" class="leancloud_visitors" data-flag-title="CS-BASIC-assembly-IA32-基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度：</span>
               
                 <span class="leancloud-visitors-count"></span>
                 <span>℃</span>
             </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">12k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">11 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="简介">简介</h2>
<p>汇编语言与机器语言之间是一一对应的,不同的<code>CPU</code>支持的机器指令也是不一样的,一种<code>CPU</code>能执行的全局机器指令集合就是该<code>CPU</code>的指令集.<code>CPU</code>顺序的执行机器指令,访问存储器获取数据,同时有若干寄存器存放临时数据.</p>
<p><code>IA-32</code>是<code>Intel</code>研发的一种<code>CPU</code>架构.包括<code>Intel 80386/80486</code>,<code>Intel Pentium</code>,<code>Intel Xeon</code>,<code>Intel Core</code>.使用小端法存储数据(高位高地址,低位低地址).</p>
<h2 id="工作方式">工作方式</h2>
<p><code>IA-32</code>系列<code>CPU</code>有三种工作方式:保护方式,实地址方式和系统管理方式;保护方式有一种子工作方式,虚拟<code>8086</code>方式.<code>IA-32</code>支持<code>8/16/32</code>位的操作数,同时支持<code>16/32</code>位的存储器寻址方式.</p>
<p>为了兼容,<code>IA-32</code>系列<code>CPU</code>支持两种段模式,<code>32</code>位段模式和<code>16</code>位段模式.<code>32</code>位段模式默认操作数尺寸为<code>8/32</code>位,默认存储器寻址方式为<code>32</code>位,<code>16</code>位段模式默认操作数尺寸为<code>8/16</code>位,默认存储器寻址方式为<code>16</code>位.保护方式下一般采用<code>32</code>位段模式,实方式下只能使用<code>16</code>位段模式.</p>
<h3 id="保护方式">保护方式</h3>
<p>保护方式是<code>IA-32</code>系列<code>CPU</code>的常态工作方式.</p>
<p>在保护方式下,全部<code>32</code>根地址线有效,可寻址<code>2 ^ 32 BYTE</code>(<code>4GB</code>)的物理地址空间;支持扩充的存储器分段管理和可选的存储器分页管理基址,为实现虚拟内存空间提供了硬件支持;支持<code>4</code>个特权级,实施特权检查.</p>
<p>保护方式下还支持虚拟<code>8086</code>方式(保护方式运行的多任务可以是不同的运行方式),可以在多任务环境下运行基于<code>Intel 8086/8088</code>处理器的程序.</p>
<h3 id="实地址方式">实地址方式</h3>
<p>实地址方式下<code>CPU</code>只能访问<code>00000H~FFFFFH</code>的地址空间(继承自<code>8086/8088</code>处理器,只有<code>20</code>根地址线),且只支持分段管理,每个段的大小为<code>64KB</code>,不支持分页存储管理机制,因为实地址方式下访问的是真实的物理地址.在开机或重设系统后<code>IA-32</code>系列<code>CPU</code>就处于实地址方式.在完成初始化工作和进入保护方式的准备后就会切换到保护方式.</p>
<p>实地址方式可以访问<code>8</code>个<code>32</code>位通用寄存器,但<code>EIP</code>,<code>ESP</code>,<code>EFLAGS</code>都只有低<code>16</code>位(<code>FLAGS</code>)起作用.实地址方式下处理器的基本执行环境和基本指令集与保护方式是相同的.不过间接寻址中不能使用比例因子.</p>
<h3 id="系统管理模式">系统管理模式</h3>
<p><code>SMM</code>(<code>system management mode</code>),源于<code>Intel 386 SL</code>处理器,<code>SMM</code>模式是<code>IA-32</code>处理器的标准特性.为操作系统和系统管理软件提供了一种透明的机制,用于实现电源管理和<code>OEM</code>厂商特有的特性.</p>
<p>通过激活外部系统中断引脚(<code>SMI#</code>),产生系统管理中断<code>SMI</code>,由此可以进入<code>SMM</code>模式.在进入<code>SMM</code>时,处理器切换到单独的地址空间,同时会保存当前运行的程序/任务的环境上下文.这样<code>SMM</code>专用的代码可以透明地执行(即操作系统/应用程序不受<code>SMM</code>模式的代码影响).当退出<code>SMM</code>模式后,处理器被置于<code>SMI</code>之前的状态,继续执行被中断的程序/任务.</p>
<h3 id="切换工作方式">切换工作方式</h3>
<img src="/posts/80651f79/1.png" title="p1">
<p>在加电冷启动,或者重置<code>reset</code>后,处理器处于实地址方式.<code>CR0</code>寄存器的<code>PE</code>标志位用于控制处理器在实模式与保护模式之间的切换.<code>EFLAGS</code>标志寄存器的<code>VM</code>标志位用于控制处理器在虚拟<code>8086</code>模式与保护模式之间的切换.这两种模式的转换通常是随着任务切换或中断/异常处理返回实现的.</p>
<p>无论何时接收到<code>SMI</code>中断且无论处理器处于何种工作方式,处理器都会切换进入<code>SMM</code>模式,当执行<code>RSM</code>(<code>SMM</code>返回指令)后,处理器会切换回<code>SMI</code>发生时的工作方式.</p>
<h2 id="寄存器">寄存器</h2>
<p><code>IA-32</code>系列<code>CPU</code>有多种寄存器.除了通用寄存器,专用寄存器(<code>EIP</code>,<code>EFLAGS</code>)和段寄存器统称为定点寄存器组,除此之外还有浮点寄存器栈和多媒体扩展寄存器组.</p>
<h3 id="通用寄存器">通用寄存器</h3>
<p><code>IA-32</code>系列<code>CPU</code>有<code>8</code>个<code>32bit</code>通用寄存器,<code>EAX</code>,<code>EBX</code>,<code>ECX</code>,<code>EDX</code>,<code>ESP</code>,<code>EBP</code>,<code>ESI</code>,<code>EDI</code>,它们的低<code>16</code>位是<code>8</code>个<code>16</code>位的通用寄存器,名称沿用以前的<code>AX</code>,<code>BX</code>,<code>CX</code>,<code>DX</code>,<code>SP</code>,<code>BP</code>,<code>SI</code>,其中<code>AX</code>,<code>BX</code>,<code>CX</code>,<code>DX</code>的高八位和低八位又分为<code>*H/L</code>.这些都是<code>Intel</code>系列向前兼容的风格(<code>Intel 80386</code>前的<code>CPU</code>最多允许<code>16</code>位操作数).</p>
<p>这些寄存器除了通用功能外还有各自的特殊用途,累加器<code>EAX</code>,基地址寄存器<code>EBX</code>,计数寄存器<code>ECX</code>,数据寄存器<code>EDX</code>,源变址寄存器<code>ESI</code>,目的变址寄存器<code>EDI</code>,基指针寄存器<code>EBP</code>,堆栈指针寄存器<code>ESP</code>(<code>ESP</code>只做此用途).</p>
<h3 id="标志寄存器">标志寄存器</h3>
<p><code>IA-32</code>系列<code>CPU</code>有一个<code>32</code>位的标志寄存器(<code>EFLAGS Register</code>),其含有一组状态标志,一组系统标志和一个控制标志.</p>
<img src="/posts/80651f79/5.png" title="p5">
<p><code>EFLAGS</code>的状态标志位(<code>0</code>,<code>2</code>,<code>4</code>,<code>6</code>,<code>7</code>,<code>11</code>)指示算术指令(如<code>add</code>,<code>sub</code>,<code>mul</code>等指令)的结果.</p>
<ul>
<li><code>CF(bit 0)</code>:无符号数最高位进位或借位置<code>1</code>,否则置<code>0</code>.称为进位标志,检测无符号操作的溢出,比较无符号数大小,还可以配合移位指令.</li>
<li><code>ZF(bit 6)</code>:结果为<code>0</code>置<code>1</code>,否则置<code>0</code>.称为零标志,检测结果是否为<code>0</code>.</li>
<li><code>SF(bit 7)</code>:带符号数的符号位.称为符号标志,其值为运算结果的最高位,检测结果是否为负数.</li>
<li><code>OF(bit 11)</code>:带符号数溢出置<code>1</code>,否则置<code>0</code>.溢出标志,检测补码溢出.</li>
<li><code>PF(bit 2)</code>:反应运算结果最低字节为<code>1</code>的位数,偶数个<code>1</code>置<code>1</code>,否则置<code>0</code>.用于串行通信的奇偶校验.</li>
<li><code>AF(bit 4)</code>:反应运算结果第<code>3</code>位是否发生进位/借位或低<code>4</code>位是否有进位/借位,是置<code>1</code>,否则置<code>0</code>.被<code>BCD</code>(<code>binary-code decimal</code>)算术运算使用.</li>
</ul>
<p><code>EFLAGS</code>的控制标志位.</p>
<ul>
<li><code>DF(bit 10)</code>:控制串指令(<code>MOVS</code>,<code>CMPS</code>,<code>SCAS</code>,<code>LODS</code>以及<code>STOS</code>).设置<code>DF</code>标志使得串指令自动递减,清除该标志则使得串指令自动递增.<code>STD</code>以及<code>CLD</code>指令分别用于设置以及清除<code>DF</code>标志.</li>
</ul>
<p><code>EFLAGS</code>的系统标志以及<code>IOPL</code>域用于控制操作系统或是执行操作,不允许被应用程序所修改.</p>
<ul>
<li><code>TF(bit 8)</code>:置<code>1</code>以允许单步调试模式,置<code>0</code>则禁用.</li>
<li><code>IF(bit 9)</code>:置<code>1</code>以响应可屏蔽中断,置<code>0</code>则禁用.</li>
<li><code>IOPL(bits 12 and 13)</code>:指示当前运行任务的<code>I/O</code>特权级(<code>I/O privilege level</code>).(正在运行任务的当前特权级(<code>CPL</code>)必须小于或等于<code>I/O</code>特权级才能允许访问<code>I/O</code>地址空间.只能在<code>CPL</code>为<code>0</code>时才能通过<code>POPF</code>以及<code>IRET</code>指令修改)</li>
<li><code>NT(bit 14)</code>:控制中断链和被调用任务.当前任务与前一执行任务相关则置<code>1</code>,否则置<code>0</code>.</li>
<li><code>RF(bit 16)</code>:控制处理器对调试异常的响应.</li>
<li><code>VM(bit 17)</code>:置<code>1</code>以允许虚拟<code>8086</code>模式,置<code>0</code>则返回保护模式.</li>
<li><code>AC(bit 18)</code>:标志及在<code>CR0</code>寄存器中的<code>AM</code>位置都为<code>1</code>时才允许内存引用的对齐检查.</li>
<li><code>VIF(bit 19)</code>:<code>IF</code>标志的虚拟镜像(<code>Virtual image</code>),与<code>VIP</code>标志结合起来使用.使用该标志及<code>VIP</code>标志,并设置<code>CR4</code>控制寄存器的<code>VME</code>标志就可以允许虚拟模式扩展(<code>virtual mode extensions</code>).</li>
<li><code>VIP(bit 20)</code>:置<code>1</code>以指示一个中断正在被挂起,当没有中断挂起时该位置<code>0</code>.与<code>VIF</code>标志结合使用.</li>
<li><code>ID(bit 21)</code>:设置或清除这个标志指示处理器对<code>CPUID</code>指令的支持.</li>
</ul>
<h3 id="段寄存器">段寄存器</h3>
<p><code>IA-32</code>系列<code>CPU</code>有一组段寄存器,支持以分段方式管理存储器.分段存储管理方式中程序使用中的存储单元总会属于某个段,所以可以使用某段某单元对存储单元进行顶为定位,其形式为段号:偏移,也称为逻辑地址.</p>
<p>对于实地址方式和保护方式来说段号是不一样的,实地址方式段号是段值,而保护模式段号是段选择子.</p>
<p>它们都会从段号获取段起始地址,与偏移相加后就得到了实际的物理地址.在保护方式下物理地址为<code>32</code>位,段起始地址和偏移都为<code>32</code>位,而实地址方式下物理地址<code>20</code>位,段起始地址<code>20</code>位,偏移则是<code>16</code>位.</p>
<p>逻辑地址中当前使用段的段号存放在段寄存器中,早期<code>Intel 8086</code>有四个段寄存器:<code>CS</code>(代码段寄存器),<code>SS</code>(堆栈段寄存器),<code>DS</code>(数据段寄存器),<code>ES</code>(附加段寄存器),从<code>Intel 80386</code>开始新增了两个附加段寄存器:<code>FS</code>,<code>GS</code>,沿用至今.这<code>6</code>个段寄存器可见部分的长度都是<code>16</code>位,实地址方式下存放<code>16</code>位的段值,保护方式下存放<code>16</code>位的段选择子.</p>
<p>不能显式地改变<code>CS</code>段寄存器,也不能把立即数直接传送到段寄存器中.</p>
<h3 id="指令指针寄存器">指令指针寄存器</h3>
<p><code>IA-32</code>系列<code>CPU</code>有一个<code>32</code>位的指令指针寄存器<code>EIP</code>,<code>CPU</code>通过<code>CS</code>和<code>EIP</code>确定所取指令的存储单元位置.<code>CPU</code>通过增加<code>EIP</code>以当前指令长度的值来顺序的执行程序,通过修改<code>EIP</code>可以控制程序的执行,完成跳转.</p>
<h2 id="汇编指令">汇编指令</h2>
<p><code>CPU</code>能直接识别并执行的指令就是机器指令,机器指令采用二进制编码,一般由操作码和操作数组成.汇编语言需要被汇编器编译成机器指令才能被<code>CPU</code>执行.</p>
<p>汇编语言的指令格式.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[标识符:] [指令助记符] [操作数表] [;注释]</span><br></pre></td></tr></table></figure>
<p>只有指令助记符是必须的,操作数表依指令助记符而定.默认情况操作数可以是通用寄存器,存储单元或立即数.如果存储器操作数长度不定(也就是两个都是存储器操作数),需要使用<code>MOV BYTE/WORD/DWORD/QWORD PTR DEST,SRC</code>(<code>MOV DEST,BYTE/WORD/DWORD/QWORD PTR SRC</code>)形式的指令指定操作数长度.</p>
<p>同时有些汇编器支持<code>FAR</code>,<code>NEAR</code>来说明标号的类型(远近).</p>
<p><code>IA-32</code>系列<code>CPU</code>通用指令基本编码格式如下.</p>
<img src="/posts/80651f79/4.png" title="p4">
<h3 id="传送指令">传送指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MOV DEST,SRC</span><br><span class="line"><span class="comment">#即赋值操作,DEST&lt;=SRC,两个操作数长度需一致,DEST必须是通用寄存器或存储单元.</span></span><br><span class="line">XCHG OPRD1,OPRD2</span><br><span class="line"><span class="comment">#将两个操作数的内容交换,两个操作数长度需一致,DEST,SRC必须是通用寄存器或存储单元且至少有一个通用寄存器.</span></span><br><span class="line">LEA REG,OPRD</span><br><span class="line"><span class="comment">#REG&lt;=&amp;OPRD,将操作数OPRD的有效地址传送到操作数REG,OPRD必须为存储器操作数,REG必须是一个16位或32位的通用寄存器,且不影响各标志位.</span></span><br></pre></td></tr></table></figure>
<h3 id="加减指令">加减指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ADD DEST,SRC</span><br><span class="line"><span class="comment">#DEST&lt;=DEST+SRC,将两个操作数内容相加并赋值给DEST,DEST必须是通用寄存器或存储单元.</span></span><br><span class="line">SUB DEST,SRC</span><br><span class="line"><span class="comment">#DEST&lt;=DEST-SRC,用DEST内容减SRC内容并赋值给DEST,DEST必须是通用寄存器或存储单元.</span></span><br><span class="line">INC DEST</span><br><span class="line"><span class="comment">#DEST&lt;=DEST+1,DEST必须是通用寄存器或存储单元.</span></span><br><span class="line">DEC DEST</span><br><span class="line"><span class="comment">#DEST&lt;=DEST-1,DEST必须是通用寄存器或存储单元.</span></span><br><span class="line">NEG DEST</span><br><span class="line"><span class="comment">#DEST&lt;=0-DEST,对操作数取补,,DEST必须是通用寄存器或存储单元.</span></span><br><span class="line">ADC DEST,SRC</span><br><span class="line"><span class="comment">#DEST&lt;=DEST+SRC+CF</span></span><br><span class="line">SBB DEST,SRC</span><br><span class="line"><span class="comment">#DEST&lt;=DEST-(SRC+CF)</span></span><br></pre></td></tr></table></figure>
<h3 id="乘除指令">乘除指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">MUL OPRD</span><br><span class="line"><span class="comment">#TYPE OPRD == BYTE -&gt; AX&lt;=OPRD*AL</span></span><br><span class="line"><span class="comment">#TYPE OPRD == WORD -&gt; DX:AX&lt;=OPRD*AX</span></span><br><span class="line"><span class="comment">#TYPE OPRD == DWORD -&gt; EDX:EAX&lt;=OPRD*EAX</span></span><br><span class="line"><span class="comment">#OPRD不能是立即数</span></span><br><span class="line">IMUL OPRD</span><br><span class="line"><span class="comment">#除了将操作数当作有符号数外与MUL一样</span></span><br><span class="line">IMUL DEST, SRC</span><br><span class="line"><span class="comment">#DEST&lt;=DEST*SRC,目的操作数DEST只能是16位或者32位通用寄存器.SRC无限制,但要求数据长度与DEST一致,为立即数的话只要长度不大于DEST数据长度即可</span></span><br><span class="line">IMUL DEST, SRC1, SRC2</span><br><span class="line"><span class="comment">#DEST&lt;=SRC1*SRC2,目的操作数DEST只能是16位或者32位通用寄存器.SRC1可以是通用寄存器或存储单元,数据长度与DEST一致.SRC2只能是立即数,同样有大小限制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#有符号数乘法指令后两种操作可能有溢出现象,处理方式为截去高位.溢出会导致CF,OF为1(包括单操作数时高半部分有有效位).</span></span><br><span class="line"><span class="comment">#无论操作数是不是有符号数,乘积的低位是相同的,所以无符号乘法指令没有双操作数和三操作数形式.</span></span><br><span class="line"></span><br><span class="line">DIV OPRD</span><br><span class="line"><span class="comment">#TYPE OPRD == BYTE -&gt; AL&lt;=AX/OPRD,余数AH</span></span><br><span class="line"><span class="comment">#TYPE OPRD == WORD -&gt; AX&lt;=DX:AX/OPRD,余数DX</span></span><br><span class="line"><span class="comment">#TYPE OPRD == DWORD -&gt; EAX&lt;=EDX:EAX/OPRD,余数EDX</span></span><br><span class="line"><span class="comment">#OPRD不能是立即数</span></span><br><span class="line">IDIV OPRD</span><br><span class="line"><span class="comment">#同上,只不过为有符号数.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果不能整除,余数符号与被除数一致,余数绝对值小于除数的绝对值</span></span><br><span class="line"><span class="comment">#除数为0,商太大或太小都会引起除法出错导致异常,除法指令对状态标志的影响无定义</span></span><br></pre></td></tr></table></figure>
<h3 id="逻辑运算指令">逻辑运算指令</h3>
<p><code>IA-32</code>逻辑运算指令有<code>NOT</code>,<code>AND</code>,<code>OR</code>,<code>XOR</code>和测试指令<code>TEST</code>,除了<code>NOT</code>外均有两个操作数.下面是它们的通用说明.</p>
<ul>
<li><code>DEST</code>可以为通用寄存器或存储单元.</li>
<li>只有一个操作数的话该操作数同时是源和目的操作数.</li>
<li>两个操作数最多一个是存储单元.</li>
<li>操作数可以是字节,字,双字,但是两个操作数数据长度必须一致.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NOT OPRD</span><br><span class="line"><span class="comment">#OPRD&lt;=~OPRD,对标志位无影响</span></span><br><span class="line">AND DEST, SRC</span><br><span class="line"><span class="comment">#OPRD&lt;=DEST&amp;SRC,CF=0,OF=0,PF,ZF,SF反映运算结果</span></span><br><span class="line">OR DEST, SRC</span><br><span class="line"><span class="comment">#OPRD&lt;=DEST|SRC,CF=0,OF=0,PF,ZF,SF反映运算结果</span></span><br><span class="line">XOR DEST, SRC</span><br><span class="line"><span class="comment">#OPRD&lt;=DEST^SRC,CF=0,OF=0,PF,ZF,SF反映运算结果</span></span><br></pre></td></tr></table></figure>
<h3 id="移位指令">移位指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SAL/SHL OPRD, count</span><br><span class="line"><span class="comment">#算术左移指令和逻辑左移指令,效果相同,且是同一条机器指令.OPRD可以为寄存器或存储单元,count可以为8位立即数或寄存器CL(表示取CL低5位)</span></span><br><span class="line"><span class="comment">#左移count位,右边补0,移出的最高位进入CF</span></span><br><span class="line">SAR OPRD, count</span><br><span class="line"><span class="comment">#算术右移指令,右移count位,左边补符号位,移出的最低位进入CF</span></span><br><span class="line">SHR OPRD, count</span><br><span class="line"><span class="comment">#逻辑右移指令,右移count位,左边补0,移出的最低位进入CF</span></span><br><span class="line">ROL/ROR OPRD, count</span><br><span class="line"><span class="comment">#左/右循环移位指令,移出位作为填充,同时进入CF</span></span><br><span class="line">RCL/RCR OPRD, count</span><br><span class="line"><span class="comment">#带进位左/右循环移位指令,移出位进入CF,CF作为填充</span></span><br><span class="line">SHLD/SHRD OPRD1, OPRD2, count</span><br><span class="line"><span class="comment">#OPRD1可以为寄存器或存储单元,OPRD2只能是寄存器,且数据长度需与OPRD1一致.</span></span><br><span class="line"><span class="comment">#把OPRD1左/右移指定的count位,使用OPRD2高/低端的count位填充,OPRD2不变,OPRD1最后移出的位进入CF</span></span><br><span class="line"><span class="comment">#仅仅移动一位的情况下若符号位发生变化,OF=1,否则OF=0</span></span><br></pre></td></tr></table></figure>
<h3 id="比较指令">比较指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMP DEST,SRC</span><br><span class="line"><span class="comment">#相当于不改变DEST的SUB,仅影响标志位</span></span><br><span class="line">TEST DEST, SRC</span><br><span class="line"><span class="comment">#与AND类似,但只影响状态标志,不改变DEST</span></span><br></pre></td></tr></table></figure>
<h3 id="循环指令">循环指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LOOP LABEL</span><br><span class="line"><span class="comment">#循环指令只用一个字节表示地址差,所以循环转移的范围仅为-128~+127.</span></span><br><span class="line"><span class="comment">#保护方式下循环指令将自动以寄存器ECX作为循环计数器.</span></span><br><span class="line"><span class="comment">#等于:DEC ECX;CMP ECX, 0;JNZ LABEL.</span></span><br><span class="line">LOOPE/LOOPZ LABEL</span><br><span class="line"><span class="comment">#多一个判断,如果ECX不等于0且零标志ZF为1就转移到LABEL处,指令本身对ECX减一的操作不影响标志.</span></span><br><span class="line">LOOPNE/LOOPNZ</span><br><span class="line"><span class="comment">#如果ECX不等于0且零标志ZF为0就转移到LABEL处,指令本身对ECX减一的操作不影响标志.</span></span><br></pre></td></tr></table></figure>
<h3 id="串操作指令">串操作指令</h3>
<p>在串操作指令中涉及源操作数时默认使用<code>ESI</code>和数据段寄存器<code>DS</code>;涉及目的操作数时默认使用<code>EDI</code>和附加段寄存器<code>ES</code>.</p>
<p>串操作指令会自动调整作为指针使用的寄存器(<code>ESI</code>,<code>EDI</code>)的值,调整的大小为字符的大小,调整的方向由<code>DF</code>(标志寄存器的位<code>10</code>)控制,为<code>0</code>时递增,为<code>1</code>时递减,下面默认<code>DF=0</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">LODSB</span><br><span class="line"><span class="comment">#MOV AL, [ESI];INC ESI;</span></span><br><span class="line">LODSW</span><br><span class="line"><span class="comment">#MOV AX, [ESI];ADD ESI, 2;</span></span><br><span class="line">LODSD</span><br><span class="line"><span class="comment">#MOV EAX, [ESI];ADD ESI, 4;</span></span><br><span class="line">STOSB</span><br><span class="line"><span class="comment">#MOV [EDI], AL;INC EDI;</span></span><br><span class="line">STOSW</span><br><span class="line"><span class="comment">#MOV [EDI], AX;ADD EDI, 2;</span></span><br><span class="line">STOSD</span><br><span class="line"><span class="comment">#MOV [EDI], EAX;ADD EDI, 4;</span></span><br><span class="line">MOVSB</span><br><span class="line"><span class="comment">#MOV BYTE PTR [EDI], [ESI];INC ESI;INC EDI;</span></span><br><span class="line">MOVSW</span><br><span class="line"><span class="comment">#MOV WORD PTR [EDI], [ESI];ADD ESI, 2;ADD EDI, 2;</span></span><br><span class="line">MOVSD</span><br><span class="line"><span class="comment">#MOV DWORD PTR [EDI], [ESI];ADD ESI, 4;ADD EDI, 4;</span></span><br><span class="line"><span class="comment">#不影响标志</span></span><br><span class="line">SCASB</span><br><span class="line"><span class="comment">#CMP AL, [EDI];INC EDI;</span></span><br><span class="line">SCASW</span><br><span class="line"><span class="comment">#CMP AX, [EDI];ADD EDI, 2;</span></span><br><span class="line">SCASD</span><br><span class="line"><span class="comment">#CMP EAX, [EDI];ADD EDI, 4;</span></span><br><span class="line">CMPSB</span><br><span class="line"><span class="comment">#CMP BYTE PTR [ESI], [EDI];INC ESI;INC EDI;</span></span><br><span class="line">CMPSW</span><br><span class="line"><span class="comment">#CMP WORD PTR [ESI], [EDI];ADD ESI, 2;ADD EDI, 2;</span></span><br><span class="line">CMPSD</span><br><span class="line"><span class="comment">#CMP DWORD PTR [ESI], [EDI];ADD ESI, 4;ADD EDI, 4;</span></span><br></pre></td></tr></table></figure>
<h4 id="重复操作前缀">重复操作前缀</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#串操作指令前缀</span></span><br><span class="line">REP CODE</span><br><span class="line"><span class="comment">#CODE为一个串操作指令,REP重复CODE指令,每次重复判断ECX是否为0,为0结束重复,否则ECX减一,继续重复.</span></span><br><span class="line">REPE/REPZ CODE</span><br><span class="line"><span class="comment">#同REP,但是判断过程多了对ZF的判断,ZF为0也结束重复.</span></span><br><span class="line">REPNZ/REPNE </span><br><span class="line"><span class="comment">#同REP,但是判断过程多了对ZF的判断,ZF为1也结束重复.</span></span><br></pre></td></tr></table></figure>
<h3 id="位操作指令">位操作指令</h3>
<p>位操作指令分为位测试指令和位扫描指令.</p>
<h4 id="位测试指令">位测试指令</h4>
<p>位测试指令中的两个操作数分别指定位串(<code>OPRD1</code>,<code>16</code>或者<code>32</code>位的通用寄存器/存储单元地址)和位号(<code>OPRD2</code>,与<code>OPRD1</code>大小相同的通用寄存器或者<code>8</code>位立即数,最后膜<code>OPRD1</code>的位大小).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BT OPRD1, OPRD2</span><br><span class="line"><span class="comment">#CF=OPRD1.bits[OPRD2]</span></span><br><span class="line">BTC OPRD1, OPRD2</span><br><span class="line"><span class="comment">#CF=OPRD1.bits[OPRD2];~OPRD1.bits[OPRD2];</span></span><br><span class="line">BTR OPRD1, OPRD2</span><br><span class="line"><span class="comment">#CF=OPRD1.bits[OPRD2];OPRD1.bits[OPRD2]=0;</span></span><br><span class="line">BTS OPRD1, OPRD2</span><br><span class="line"><span class="comment">#CF=OPRD1.bits[OPRD2];OPRD1.bits[OPRD2]=1;</span></span><br></pre></td></tr></table></figure>
<h4 id="位扫描指令">位扫描指令</h4>
<p>位扫描指令的<code>OPRD1</code>是<code>16</code>或者<code>32</code>位的通用寄存器,<code>OPRD2</code>是与<code>OPRD1</code>大小相同的通用寄存器或者存储单元.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BSF OPRD1, OPRD2</span><br><span class="line"><span class="comment">#从低位向高位扫描OPRD2中第一个为1的位并将对应的位号赋值给OPRD1.</span></span><br><span class="line">BSR OPRD1, OPRD2</span><br><span class="line"><span class="comment">#从高位向低位扫描OPRD2中第一个为1的位并将对应的位号赋值给OPRD1.</span></span><br><span class="line"><span class="comment">#如果OPRD2为0,则ZF=1,OPRD1不确定.否则ZF=0.</span></span><br></pre></td></tr></table></figure>
<h3 id="状态标志操作指令">状态标志操作指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CLC</span><br><span class="line"><span class="comment">#CF&lt;=0</span></span><br><span class="line">STC</span><br><span class="line"><span class="comment">#CF&lt;=1</span></span><br><span class="line">CMC</span><br><span class="line"><span class="comment">#CF&lt;=!CF</span></span><br><span class="line">LAHF</span><br><span class="line"><span class="comment">#AH&lt;=EFLAGS低八位</span></span><br><span class="line">SAHF</span><br><span class="line"><span class="comment">#EFLAGS低八位&lt;=AH,只影响对应的状态标志(SF,ZF,AF,PF,CF).</span></span><br><span class="line">CLD</span><br><span class="line"><span class="comment">#DF&lt;=0</span></span><br><span class="line">STD</span><br><span class="line"><span class="comment">#DF&lt;=1</span></span><br></pre></td></tr></table></figure>
<h3 id="转移指令">转移指令</h3>
<p>转移指令不影响标志位.</p>
<img src="/posts/80651f79/2.png" title="p2">
<p>还有计数器转移指令<code>JECXZ</code>,当<code>ECX</code>为<code>0</code>就转移.</p>
<h3 id="条件设置字节指令">条件设置字节指令</h3>
<p>条件设置字节指令不影响标志位.</p>
<img src="/posts/80651f79/3.png" title="p3">
<h3 id="堆栈指令">堆栈指令</h3>
<p>堆栈是一段内存区域,以低地址为栈顶,高地址为栈底.由<code>ESP</code>指示偏移,<code>SS</code>指示区域,合指栈顶,栈底由内核变量记录.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUSH SRC</span><br><span class="line"><span class="comment">#将SRC操作数压入堆栈,同时ESP-=SRC的长度</span></span><br><span class="line"><span class="comment">#等同于:MOV ESP,SRC;SUB ESP,SRC_LEN</span></span><br><span class="line">POP DEST</span><br><span class="line"><span class="comment">#将栈顶的数据赋给DEST,ESP+=DEST的长度</span></span><br><span class="line"><span class="comment">#等同于:ADD ESP,DEST_LEN;MOV DEST,ESP</span></span><br><span class="line">PUSHA</span><br><span class="line"><span class="comment">#将所有16位通用寄存器的内容压入堆栈,顺序为AX,CX,DX,BX,SP,BP,SI,DI.然后SP-=16.</span></span><br><span class="line">POPA</span><br><span class="line"><span class="comment">#执行PUSHA相反操作.SP+=16.</span></span><br><span class="line">PUSHAD</span><br><span class="line"><span class="comment">#将所有32位通用寄存器的内容压入堆栈,顺序为EAX,ECX,EDX,EBX,ESP,EBP,ESI,EDI.然后ESP-=32.</span></span><br><span class="line">POPAD</span><br></pre></td></tr></table></figure>
<h3 id="符号扩展指令">符号扩展指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CBW</span><br><span class="line"><span class="comment">#把寄存器AL的值符号扩展到AH,即用AL的符号位填充AH</span></span><br><span class="line">CWD</span><br><span class="line"><span class="comment">#把寄存器AX的值符号扩展到DX</span></span><br><span class="line">CDQ</span><br><span class="line"><span class="comment">#把寄存器EAX的值符号扩展到EDX</span></span><br><span class="line">CWDE</span><br><span class="line"><span class="comment">#把寄存器AX的值符号扩展到EAX高半部分</span></span><br><span class="line"><span class="comment">#都不影响状态标志</span></span><br></pre></td></tr></table></figure>
<h3 id="扩展传送指令">扩展传送指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MOVSX DEST, SRC</span><br><span class="line"><span class="comment">#DEST只能时通用寄存器,SRC可以为通用寄存器或存储单元.DEST数据长度必须大于SRC,该指令将SRC符号扩展后赋值给DEST.</span></span><br><span class="line"><span class="comment">#DEST可以为16位或32位,SRC可以为8位或16位</span></span><br><span class="line">MOVZX DEST, SRC</span><br><span class="line"><span class="comment">#同上,只是SRC进行的是零扩展</span></span><br></pre></td></tr></table></figure>
<h3 id="过程调用指令和返回指令">过程调用指令和返回指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CALL OPRD</span><br><span class="line"><span class="comment">#PUSH PC;EIP&lt;=OPRD;实际只比跳转多了一个返回地址压栈.</span></span><br><span class="line">RET [count]</span><br><span class="line"><span class="comment">#POP EIP.</span></span><br><span class="line"><span class="comment">#ESP&lt;=ESP+count</span></span><br></pre></td></tr></table></figure>
<h3 id="中断控制指令">中断控制指令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CLI</span><br><span class="line"><span class="comment">#屏蔽中断</span></span><br><span class="line">STI</span><br><span class="line"><span class="comment">#恢复中断</span></span><br></pre></td></tr></table></figure>
<p>进行不能分离的操作比如设置栈基址<code>SS</code>和偏移地址<code>SP</code>时,需要先屏蔽中断.</p>
<h2 id="寻址方式">寻址方式</h2>
<p><code>CPU</code>常用的寻址方式可分为:立即寻址,寄存器寻址和存储器寻址.(此外还有固定寻址和<code>I/O</code>端口寻址)</p>
<img src="/posts/80651f79/6.png" title="p6">
<h3 id="立即寻址">立即寻址</h3>
<p>立即寻址即直接将操作数作为指令的一部分给出,这样的操作数也称为立即数.(只有源操作数使用立即寻址,且此时源操作数的长度由目的操作数决定)</p>
<h3 id="寄存器寻址">寄存器寻址</h3>
<p>寄存器寻址即使用寄存器的内容作为操作数,在指令中将寄存器名给出.</p>
<h3 id="存储器寻址">存储器寻址</h3>
<p>存储器寻址即给出存储单元偏移从而通过偏移和段起始地址访问对应存储单元作为操作数的方式.有多种存储器寻址方式.</p>
<p>直接寻址:<code>MOV EAX, [95480H]</code>.</p>
<p>寄存器间接寻址:通过基址,变址,比例和位移量获取存储器单元偏移,偏移<code>EA</code>为:基址<code>+</code>变址<code>*</code>比例<code>+</code>位移量.<code>mov EAX, [ESI + EDI * 4 + 12H]</code>.其中基址可以为所以通用寄存器,变址可以为除<code>ESP</code>所以通用寄存器,比例可以为<code>1</code>,<code>2</code>,<code>4</code>,<code>8</code>,位移量为一个数.</p>
<p>在<code>32</code>位的存储器寻址方式中,如果基址寄存器不是<code>EBP</code>或<code>ESP</code>,默认段寄存器为<code>DS</code>,是的话默认段寄存器为<code>SS</code>.</p>
<p>实地址方式存储单元的有效地址(偏移)不应该超过<code>FFFFH</code>,超过则会触发异常.</p>
<h2 id="分支与循环">分支与循环</h2>
<p>分支程序一般使用<code>cmp</code>,<code>test</code>等指令判断,条件跳转指令跳转配合实现.减少转移是优化分支的方法.</p>
<p>循环程序与分支程序同理,只需要添加一个若不满足条件则跳回开头的指令序列即可,同时<code>IA-32</code>还提供了专门的循环指令<code>loop</code>.</p>
<h2 id="过程调用">过程调用</h2>
<p><code>C</code>语言中的函数就是汇编语言中的子程序,也就是过程.其本质是控制流的转移(<code>PC</code>的改变),<code>CPU</code>提供专门的指令<code>call</code>,<code>ret</code>来进行过程调用与返回.调用时将返回地址入栈(一个存储数据的区域),返回时通过读取栈中的返回地址返回,本质上就是数据的读写.(<code>eax</code>寄存器默认用于存储程序的返回值)</p>
<p>函数调用将栈划分为一个个栈帧,从逻辑上讲,栈帧就是一个函数执行的环境:函数参数,函数的局部变量,函数返回地址等等.<code>ebp</code>即帧指针,指向当前栈帧的底部,上一栈帧的顶部.<code>esp</code>即栈指针,指向当前栈帧的顶部(同时也是栈的顶部),下一将要插入的栈帧的底部.这两个指针的值规定了当前栈帧范围.</p>
<p>函数调用前首先要处理参数,<code>x86</code>有三种常用调用约定,<code>cdecl</code>(<code>C</code>规范),<code>stdcall</code>(<code>WinAPI</code>默认),<code>fastcall</code>函数调用约定.<code>x86</code>的<code>Linux</code>使用<code>cdecl</code>调用.</p>
<ul>
<li><code>cdecl</code>:参数从右往左一次入栈,调用者实现栈平衡,返回值存放在<code>eax</code>中.</li>
<li><code>stdcall</code>:参数从右往左一次入栈,被调用者实现栈平衡,返回值存放在<code>eax</code>中.</li>
<li><code>fastcall</code>:参数<code>1</code>,<code>2</code>分别保存在<code>ecx</code>,<code>edx</code>;剩下的参数从右往左一次入栈,被调用者实现栈平衡,返回值存放在<code>eax</code>中.</li>
</ul>
<p><code>x86-64</code>的<code>Linux</code>前六个整型参数通过寄存器传递,按顺序为:<code>rdi</code>,<code>rsi</code>,<code>rdx</code>,<code>rcx</code>,<code>r8</code>,<code>r9</code>.同时<code>xmm0</code>到<code>xmm7</code>用来放置浮点参数,其他的参数入栈(从右至左向<code>8</code>字节对齐).</p>
<p>在参数处理完后就会执行<code>call</code>指令,这个指令首先将返回地址放入栈中,然后跳转到函数代码执行.被调用的函数会在开始保存<code>ebp</code>,赋值<code>ebp</code>为<code>esp</code>,然后对<code>esp</code>进行减操作来扩展栈的内存空间以容纳局部变量,此时该函数的栈帧成型.</p>
<p>被调用函数执行完后通过<code>ret</code>指令返回调用函数,<code>ret</code>之前会赋值<code>esp</code>为<code>ebp</code>(之前保存的),然后恢复<code>ebp</code>,此时栈顶为返回地址.<code>ret</code>通过返回地址跳转.</p>
<p>堆栈平衡其实就是主程序与子程序之间栈帧的切换,堆栈平衡不断复用栈的空间存储栈帧,使函数调用内存消耗变少.</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">push</span> <span class="built_in">ebp</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ebp</span>, <span class="built_in">esp</span></span><br><span class="line"><span class="keyword">sub</span> <span class="built_in">esp</span>, <span class="number">0x20</span>  <span class="comment">;为局部变量开辟空间</span></span><br><span class="line"><span class="comment">;...</span></span><br><span class="line"><span class="keyword">leave</span>          <span class="comment">;等于:mov esp, ebp;pop ebp;</span></span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure>
<p>由于程序运行过程中会使用到各寄存器来进行数据处理,而子程序可能会改变主程序正在使用的寄存器.这就需要进行选择,子程序和主程序谁来保护寄存器的值.</p>
<p>其中<code>x86-64</code>采用了一组统一的寄存器使用惯例,<code>%rbx</code>,<code>%rbp</code>,<code>%r12~%r15</code>为被调用者保存寄存器,而所有其他寄存器除了<code>%rsp</code>都为调用者保存寄存器.</p>
<h2 id="系统调用">系统调用</h2>
<p><code>32</code>位<code>Linux</code>系统调用通过<code>int 0x80</code>来实现的,<code>eax</code>寄存器中为调用的功能号,<code>ebx</code>,<code>ecx</code>,<code>edx</code>,<code>esi</code>等寄存器则依次为参数.</p>
<p>该调用是从左至右依次传参,与普通函数不同.<a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/syscalls/syscall_32.tbl" target="_blank" rel="noopener">在线<code>32</code>位系统调用号</a>.</p>
<p><code>64</code>位<code>Linux</code>系统调用通过<code>syscall</code>指令进入,传参寄存器为:<code>rdi</code>,<code>rsi</code>,<code>rdx</code>,<code>r10</code>,<code>r8</code>和<code>r9</code>.<code>rax</code>为系统调用号.</p>
<p>系统调用限制最多<code>6</code>个参数.返回结果在<code>rax</code>寄存器中.<a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/syscalls/syscall_64.tbl" target="_blank" rel="noopener">在线<code>64</code>位系统调用号</a>.</p>
<p>系统调用定义文件<code>/usr/include/asm/unistd_32.h</code>,<code>/usr/include/asm/unistd_64.h</code>,<code>/usr/include/bits/syscall.h</code>.</p>
<h2 id="汇编指示与伪指令简介">汇编指示与伪指令简介</h2>
<p>汇编指示与伪指令是汇编器提供的用于定义段名,过程名和控制一些编译选项的指令,各汇编器有所不同.</p>
<h3 id="masm">MASM</h3>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.686p</span><span class="comment">;指定处理器的型号或适用的指令集,.686p表示Pentium Pro及以上的处理器</span></span><br><span class="line">include listing.inc<span class="comment">;包含文件listing.inc</span></span><br><span class="line"><span class="meta">.model</span> flat<span class="comment">;采用平坦模式,各存储段重叠.</span></span><br><span class="line"></span><br><span class="line">INCLUDELIB LIBCMTD<span class="comment">;包含导入库文件</span></span><br><span class="line"></span><br><span class="line">CONST <span class="meta">SEGMENT</span><span class="comment">;段CONST开始</span></span><br><span class="line">$haa <span class="built_in">DB</span> <span class="string">'\n'</span>, <span class="number">00H</span><span class="comment">;定义变量</span></span><br><span class="line">CONST ENDS<span class="comment">;段CONST结束</span></span><br><span class="line"></span><br><span class="line"><span class="meta">PUBLIC</span> _main<span class="comment">;声明公用标号_main</span></span><br><span class="line">EXTRN _printf:PROC<span class="comment">;声明外部过程_printf</span></span><br><span class="line"></span><br><span class="line">_TEXT <span class="meta">SEGMENT</span></span><br><span class="line">_var1$=-<span class="number">4</span><span class="comment">;定义符号值,标识符_var1代表常数-4</span></span><br><span class="line">_main PROC<span class="comment">;过程_main开始</span></span><br><span class="line">  ...</span><br><span class="line">_main ENDP<span class="comment">;过程_main结束</span></span><br><span class="line">_TEXT ENDS</span><br><span class="line">END<span class="comment">;指示程序结束</span></span><br></pre></td></tr></table></figure>
<h3 id="nasm">NASM</h3>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">segment</span> text<span class="comment">;命名段text</span></span><br><span class="line">org <span class="number">100H</span><span class="comment">;段内偏移从100H开始计算,COM程序会从段内偏移100H开始执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>, <span class="built_in">CS</span></span><br><span class="line"><span class="keyword">MOV</span> <span class="built_in">DS</span>, <span class="built_in">AX</span></span><br><span class="line"><span class="comment">;使数据段和代码段相同</span></span><br><span class="line"><span class="keyword">MOV</span> <span class="built_in">DX</span>, hello<span class="comment">;参数[DS:DX]</span></span><br><span class="line"><span class="keyword">MOV</span> <span class="number">AH</span>, <span class="number">9</span><span class="comment">;调用号</span></span><br><span class="line"><span class="keyword">INT</span> <span class="number">21H</span></span><br><span class="line"><span class="comment">;调用系统例程输出字符串</span></span><br><span class="line"><span class="keyword">MOV</span> <span class="number">AH</span>, <span class="number">4CH</span></span><br><span class="line"><span class="keyword">INT</span> <span class="number">21H</span></span><br><span class="line"><span class="comment">;调用系统例程结束程序</span></span><br><span class="line">hello <span class="built_in">db</span> <span class="string">"Hello,world"</span>, <span class="number">0DH</span>, <span class="number">0AH</span>, <span class="string">'$'</span></span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/assembly/" rel="tag"><i class="fa fa-tag"></i> assembly</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/efc29a0d/" rel="next" title="IS-reverse-tool-WinDbg">
                <i class="fa fa-chevron-left"></i> IS-reverse-tool-WinDbg
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/8661c647/" rel="prev" title="CS-BASIC-algorithm-排序算法">
                CS-BASIC-algorithm-排序算法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/apple-touch-icon.png" alt="w4rd3n">
            
              <p class="site-author-name" itemprop="name">w4rd3n</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">169</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/hitworld" title="GitHub &rarr; https://github.com/hitworld" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工作方式"><span class="nav-number">2.</span> <span class="nav-text">工作方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#保护方式"><span class="nav-number">2.1.</span> <span class="nav-text">保护方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实地址方式"><span class="nav-number">2.2.</span> <span class="nav-text">实地址方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统管理模式"><span class="nav-number">2.3.</span> <span class="nav-text">系统管理模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切换工作方式"><span class="nav-number">2.4.</span> <span class="nav-text">切换工作方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#寄存器"><span class="nav-number">3.</span> <span class="nav-text">寄存器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#通用寄存器"><span class="nav-number">3.1.</span> <span class="nav-text">通用寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标志寄存器"><span class="nav-number">3.2.</span> <span class="nav-text">标志寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#段寄存器"><span class="nav-number">3.3.</span> <span class="nav-text">段寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指令指针寄存器"><span class="nav-number">3.4.</span> <span class="nav-text">指令指针寄存器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#汇编指令"><span class="nav-number">4.</span> <span class="nav-text">汇编指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#传送指令"><span class="nav-number">4.1.</span> <span class="nav-text">传送指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加减指令"><span class="nav-number">4.2.</span> <span class="nav-text">加减指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#乘除指令"><span class="nav-number">4.3.</span> <span class="nav-text">乘除指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑运算指令"><span class="nav-number">4.4.</span> <span class="nav-text">逻辑运算指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移位指令"><span class="nav-number">4.5.</span> <span class="nav-text">移位指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比较指令"><span class="nav-number">4.6.</span> <span class="nav-text">比较指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环指令"><span class="nav-number">4.7.</span> <span class="nav-text">循环指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#串操作指令"><span class="nav-number">4.8.</span> <span class="nav-text">串操作指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#重复操作前缀"><span class="nav-number">4.8.1.</span> <span class="nav-text">重复操作前缀</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位操作指令"><span class="nav-number">4.9.</span> <span class="nav-text">位操作指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#位测试指令"><span class="nav-number">4.9.1.</span> <span class="nav-text">位测试指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#位扫描指令"><span class="nav-number">4.9.2.</span> <span class="nav-text">位扫描指令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态标志操作指令"><span class="nav-number">4.10.</span> <span class="nav-text">状态标志操作指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转移指令"><span class="nav-number">4.11.</span> <span class="nav-text">转移指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件设置字节指令"><span class="nav-number">4.12.</span> <span class="nav-text">条件设置字节指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#堆栈指令"><span class="nav-number">4.13.</span> <span class="nav-text">堆栈指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#符号扩展指令"><span class="nav-number">4.14.</span> <span class="nav-text">符号扩展指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#扩展传送指令"><span class="nav-number">4.15.</span> <span class="nav-text">扩展传送指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#过程调用指令和返回指令"><span class="nav-number">4.16.</span> <span class="nav-text">过程调用指令和返回指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中断控制指令"><span class="nav-number">4.17.</span> <span class="nav-text">中断控制指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#寻址方式"><span class="nav-number">5.</span> <span class="nav-text">寻址方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#立即寻址"><span class="nav-number">5.1.</span> <span class="nav-text">立即寻址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#寄存器寻址"><span class="nav-number">5.2.</span> <span class="nav-text">寄存器寻址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#存储器寻址"><span class="nav-number">5.3.</span> <span class="nav-text">存储器寻址</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分支与循环"><span class="nav-number">6.</span> <span class="nav-text">分支与循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过程调用"><span class="nav-number">7.</span> <span class="nav-text">过程调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统调用"><span class="nav-number">8.</span> <span class="nav-text">系统调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#汇编指示与伪指令简介"><span class="nav-number">9.</span> <span class="nav-text">汇编指示与伪指令简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#masm"><span class="nav-number">9.1.</span> <span class="nav-text">MASM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nasm"><span class="nav-number">9.2.</span> <span class="nav-text">NASM</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-gg-circle"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">w4rd3n</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">788k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">11:56</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script type="text/javascript" color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.time + 1);
            })
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1}))
                .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function () {
                  console.log('Failed to create');
                });
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "no3Ip4mNLc3JyF1AeTy8LrAm-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "no3Ip4mNLc3JyF1AeTy8LrAm-gzGzoHsz",
                'X-LC-Key': "UvlYMzpJKw0Jrw61V5BA5ifU",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script>



  

  

  

  
  

  
  

  


  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>;
  <script>
  //$("body").backstretch("/images/background.jpg");
  </script>
  
  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body>
</html>
